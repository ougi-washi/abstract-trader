// abstract-trader https://github.com/ougi-washi/abstract-trader
  
#include "core/types.h"
#include "core/log.h"
#include "core/render.h"

at_tick ticks_sample[] = {
    {142.0, 100.0}, {144.0, 100.0}, {145.5, 100.0}, {143.0, 100.0}, {147.0, 100.0}, {150.0, 100.0},
    {149.0, 100.0}, {152.0, 100.0}, {148.0, 100.0}, {146.0, 100.0}, {144.5, 100.0}, {147.5, 100.0},
    {135.0, 100.0}, {137.0, 100.0}, {139.5, 100.0}, {136.5, 100.0}, {140.0, 100.0}, {142.5, 100.0},
    {130.0, 100.0}, {132.0, 100.0}, {134.0, 100.0}, {133.5, 100.0}, {136.0, 100.0}, {138.0, 100.0},
    {125.0, 100.0}, {123.0, 100.0}, {126.5, 100.0}, {127.0, 100.0}, {129.0, 100.0}, {130.5, 100.0},
    {140.0, 100.0}, {141.5, 100.0}, {144.0, 100.0}, {145.0, 100.0}, {142.5, 100.0}, {141.0, 100.0},
    {155.0, 100.0}, {157.0, 100.0}, {159.0, 100.0}, {160.0, 100.0}, {161.5, 100.0}, {162.0, 100.0},
    {150.0, 100.0}, {148.5, 100.0}, {147.0, 100.0}, {146.0, 100.0}, {149.5, 100.0}, {151.0, 100.0},
    {168.0, 100.0}, {169.0, 100.0}, {170.0, 100.0}, {173.0, 100.0}, {175.0, 100.0}, {174.0, 100.0},
    {180.0, 100.0}, {178.0, 100.0}, {181.0, 100.0}, {182.5, 100.0}, {185.0, 100.0}, {186.0, 100.0},
    {175.5, 100.0}, {172.0, 100.0}, {173.5, 100.0}, {176.0, 100.0}, {179.0, 100.0}, {181.5, 100.0},
    {166.0, 100.0}, {164.5, 100.0}, {167.0, 100.0}, {170.0, 100.0}, {168.5, 100.0}, {169.5, 100.0},
    {154.0, 100.0}, {156.0, 100.0}, {155.5, 100.0}, {153.0, 100.0}, {157.0, 100.0}, {159.0, 100.0},
    {140.0, 100.0}, {138.0, 100.0}, {141.0, 100.0}, {144.5, 100.0}, {146.5, 100.0}, {149.0, 100.0},
    {132.5, 100.0}, {134.0, 100.0}, {136.5, 100.0}, {139.0, 100.0}, {141.5, 100.0}, {144.0, 100.0},
    {120.0, 100.0}, {118.0, 100.0}, {121.0, 100.0}, {123.5, 100.0}, {125.0, 100.0}, {126.5, 100.0},
    {110.0, 100.0}, {111.5, 100.0}, {112.0, 100.0}, {113.5, 100.0}, {115.0, 100.0}, {118.5, 100.0},
    {100.0, 100.0}, {102.0, 100.0}, {103.5, 100.0}, {105.0, 100.0}, {107.0, 100.0}, {109.0, 100.0},
};

i32 main(i32 argc, c8 **argv) {
    at_render render = {0};
    at_init_render(&render);
    at_symbol symbol = {0};
    at_init_symbol(&symbol, "AAPL", "NASDAQ", "USD", 0);
    sz ticks_count = sizeof(ticks_sample) / sizeof(at_tick);
    at_add_ticks(&symbol, ticks_sample, ticks_count);

    u32 candle_count = 0;
    at_candle* candles = at_get_candles(&symbol, 5, &candle_count); // 3 seconds candles (if ticks are in seconds)
    if (candles) {
        for (u32 i = 0; i < candle_count; i++) {
            log_info("Candle %u: Open=%.2f, High=%.2f, Low=%.2f, Close=%.2f, Volume=%.2f",
                i, candles[i].open, candles[i].high, candles[i].low,
                candles[i].close, candles[i].volume);
        }
    }

    at_render_object object = {0};
    at_candles_to_render_object(candles, candle_count, &object);
    at_add_render_object(&render, &object);

    while (at_should_loop_render(&render)) {
        at_draw_render(&render);
    }

    free(candles);
    at_free_symbol(&symbol);
    return 0;
}